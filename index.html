<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic Tac Toe 9x9</title>
    <style>
        body
        {
            height: 100%;
            width: 100%;
            font-size: 25px;
            margin: 5px;
            user-select: none;
            justify-content: center;
            justify-items: center;
        }
        table < tr < td < tr < td
        {
            height: 25px;
            width: 25px;
        }
        table < tr < td
        {
            width: 100%;
        button
        {
            height: 25px;
            width: 25px;
            cursor: pointer;
            user-select: none;
        }
        .restartBtn
        {
            width: 150px;
            height: 50px;
            font-family: sans-serif;
            font-size: 25px;
            background-color: aqua;
            border-radius: 10px;
            border: none;
        }
        .mainTable table
        {
            width: 100px;
            height: 100px;
            user-select: none;
            margin: 2px;
            position: relative;
        }
        .mainTable
        {
            background-color: grey;
            width: 100%;
        }
        .mainTable div
        {
            position: absolute;
            width: 100px;
            height: 100px;
            z-index: 10;
            background-color: rgba(175, 175, 175, 0.5);
            padding: 1px;
            display: none;
            color: black;
            text-align: center;
            font-size: 100px;
            font-family: sans-serif;
        }
        .turn
        {
          width: 100px;
          height: 50px;
          padding: 5px;
          text-align: center;
          font-family: sans-serif;
          font-size: 50px;
          color: black;
        }
        .elements div
        {
          width: 100px;
          text-align: center;
          font-family: sans-serif;
          font-size: 50px;
          color: black;
        }
        .elements
        {
          display: flex;
            width: 100%;
        }
    </style>
    <script>
        var isZero = false;
        var isFinished = false;
        var dataSub = "";
        var [secondsX, minutesX] = [0, 5];
        var [secondsO, minutesO] = [0, 5];
        var interval = null;

        document.addEventListener("click", function(event) {
           if(event.target.tagName === "BUTTON")
            {
                if( isFinished || event.target.innerText != "" || (event.target.getAttribute("data-main") != dataSub && dataSub != "")) return;
                if(interval === null) interval = setInterval(displayTimer, 1000);
                if(dataSub != "")document.querySelector(`table[data-sub="${dataSub}"]`).style.backgroundColor = "unset";
                dataSub = document.getElementById(event.target.getAttribute("data-sub")).style.display === "unset" ? "" : event.target.getAttribute("data-sub");
                if(dataSub != "")
                {
                  document.getElementById("mainTable").style.backgroundColor = "unset";
                  document.querySelector(`table[data-sub="${dataSub}"]`).style.backgroundColor = "grey";
                }
                else document.getElementById("mainTable").style.backgroundColor = "grey";
                event.target.innerText = isZero ? (isZero = false, document.getElementById("turn").innerText = "X", "O") : (isZero = true, document.getElementById("turn").innerText = "O", "X");
                checkWinner(event.target.getAttribute("data-main"));
            } 
        });
        function checkWinner(dataMain)
        {
            let buttons = document.querySelector(`table[data-sub="${dataMain}"]`).querySelectorAll("button");

            let isO = false;
            for(let a = 0; a <= 6; a += 3)
            {
                isO = buttons[a].innerText == "O" ? true : buttons[a].innerText == "X" ? false : null;
                if(isO && buttons[a+1].innerText == "O" && buttons[a+2].innerText == "O") winner("O", dataMain, false);
                else if(isO === false && buttons[a+1].innerText == "X" && buttons[a+2].innerText == "X") winner("X", dataMain, false);
            }
            for(let a = 0; a <= 2; a++)
            {
                isO = buttons[a].innerText == "O" ? true : buttons[a].innerText == "X" ? false : null;
                if(isO && buttons[a+3].innerText == "O" && buttons[a+6].innerText == "O") winner("O", dataMain, false);
                else if(isO === false && buttons[a+3].innerText == "X" && buttons[a+6].innerText == "X") winner("X", dataMain, false);
            }
            if(buttons[0].innerText == "O" && buttons[4].innerText == "O" && buttons[8].innerText == "O") winner("O", dataMain, false);
            else if(buttons[0].innerText == "X" && buttons[4].innerText == "X" && buttons[8].innerText == "X") winner("X", dataMain, false);
            else if(buttons[2].innerText == "O" && buttons[4].innerText == "O" && buttons[6].innerText == "O") winner("O", dataMain, false);
            else if(buttons[2].innerText == "X" && buttons[4].innerText == "X" && buttons[6].innerText == "X") winner("X", dataMain, false);

            buttons = document.getElementById("mainTable").querySelectorAll("div");

            isO = false;
            for(let a = 0; a <= 6; a += 3)
            {
                isO = buttons[a].innerText == "O" ? true : buttons[a].innerText == "X" ? false : null;
                if(isO && buttons[a+1].innerText == "O" && buttons[a+2].innerText == "O") return winner("O", dataMain, true);
                else if(isO === false && buttons[a+1].innerText == "X" && buttons[a+2].innerText == "X") return winner("X", dataMain, true);
            }
            for(let a = 0; a <= 2; a++)
            {
                isO = buttons[a].innerText == "O" ? true : buttons[a].innerText == "X" ? false : null;
                if(isO && buttons[a+3].innerText == "O" && buttons[a+6].innerText == "O") return winner("O", dataMain, true);
                else if(isO === false && buttons[a+3].innerText == "X" && buttons[a+6].innerText == "X") return winner("X", dataMain, true);
            }
            if(buttons[0].innerText == "O" && buttons[4].innerText == "O" && buttons[8].innerText == "O") return winner("O", dataMain, true);
            else if(buttons[0].innerText == "X" && buttons[4].innerText == "X" && buttons[8].innerText == "X") return winner("X", dataMain, true);
            else if(buttons[2].innerText == "O" && buttons[4].innerText == "O" && buttons[6].innerText == "O") return winner("O", dataMain, true);
            else if(buttons[2].innerText == "X" && buttons[4].innerText == "X" && buttons[6].innerText == "X") return winner("X", dataMain, true);
        }
        function start()
        {
            isFinished = false;
            isZero = false;
            document.getElementById("restartBtn").style.display = "none";
            clearInterval(interval);
            interval = null;
            document.getElementById("timerO").innerText = "5:00";
            document.getElementById("timerX").innerText = "5:00";
            [secondsX, minutesX] = [0, 5];
            [secondsO, minutesO] = [0, 5];
            tables = document.getElementById("mainTable").querySelectorAll("table");
            tables.forEach(table => {
              table
              buttons = table.querySelectorAll("button");
              buttons.forEach(button => {
                button.innerText = "";
              });
            });
            document.getElementById("mainTable").style.backgroundColor = "grey";
            document.getElementById("turn").innerText = "X";
        }
        function winner(winner, table, isEnd)
        {
          console.log(isEnd);
            document.getElementById(table).innerText = winner == "draw" ? "" : (document.getElementById(table).style.display = "unset", winner);
            if(isEnd)
            {
              alert(winner == "X" ? "Krestik" : winner == "O" ? "Nolik" : "Draw!");
              isFinished = true;
              clearInterval(interval);
              interval = null
              document.getElementById("mainTable").style.backgroundColor = "unset";
            } 
        }
        function displayTimer()
        {
          console.log("asdasdasd");
          if(isZero)
          {
            if(secondsO == 0) 
            {
              minutesO--;
              secondsO += 59;
            }
            else secondsO--;
            if(secondsO < 10) document.getElementById("timerO").innerText = `${minutesO}:0${secondsO}`;
            else document.getElementById("timerO").innerText = `${minutesO}:${secondsO}`;
          }
          else
          {
            if(secondsX == 0) 
              {
                minutesX--;
                secondsX += 59;
              }
              else secondsX--;
              if(secondsX < 10)document.getElementById("timerX").innerText = `${minutesX}:0${secondsX}`;
              else document.getElementById("timerX").innerText = `${minutesX}:${secondsX}`;
          }
        }
    </script>
</head>
<body>
  <div class="elements">
    <div class="timerX" id="timerX">5:00</div>
    <p id="turn" class="turn">X</p>
    <div class="timerO" id="timerO">5:00</div>
  </div>
  
    <table class="mainTable" id="mainTable">
        <tr>
            <td>
                <div id="0-0"></div>
                <table data-sub="0-0">
                    <tr>
                        <td><button data-main="0-0" data-sub="0-0"></button></td>
                        <td><button data-main="0-0" data-sub="0-1"></button></td>
                        <td><button data-main="0-0" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="0-0" data-sub="1-0"></button></td>
                        <td><button data-main="0-0" data-sub="1-1"></button></td>
                        <td><button data-main="0-0" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="0-0" data-sub="2-0"></button></td>
                        <td><button data-main="0-0" data-sub="2-1"></button></td>
                        <td><button data-main="0-0" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
            <td>
                <div id="0-1" class="table0-1"></div>
                <table data-sub="0-1">
                    <tr>
                        <td><button data-main="0-1" data-sub="0-0"></button></td>
                        <td><button data-main="0-1" data-sub="0-1"></button></td>
                        <td><button data-main="0-1" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="0-1" data-sub="1-0"></button></td>
                        <td><button data-main="0-1" data-sub="1-1"></button></td>
                        <td><button data-main="0-1" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="0-1" data-sub="2-0"></button></td>
                        <td><button data-main="0-1" data-sub="2-1"></button></td>
                        <td><button data-main="0-1" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
            <td>
                <div id="0-2"></div>
                <table data-sub="0-2">
                    <tr>
                        <td><button data-main="0-2" data-sub="0-0"></button></td>
                        <td><button data-main="0-2" data-sub="0-1"></button></td>
                        <td><button data-main="0-2" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="0-2" data-sub="1-0"></button></td>
                        <td><button data-main="0-2" data-sub="1-1"></button></td>
                        <td><button data-main="0-2" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="0-2" data-sub="2-0"></button></td>
                        <td><button data-main="0-2" data-sub="2-1"></button></td>
                        <td><button data-main="0-2" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <div id="1-0" class="table1-0"></div>
                <table data-sub="1-0">
                    <tr>
                        <td><button data-main="1-0" data-sub="0-0"></button></td>
                        <td><button data-main="1-0" data-sub="0-1"></button></td>
                        <td><button data-main="1-0" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="1-0" data-sub="1-0"></button></td>
                        <td><button data-main="1-0" data-sub="1-1"></button></td>
                        <td><button data-main="1-0" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="1-0" data-sub="2-0"></button></td>
                        <td><button data-main="1-0" data-sub="2-1"></button></td>
                        <td><button data-main="1-0" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
            <td>
                <div id="1-1" class="table1-1"></div>
                <table data-sub="1-1">
                    <tr>
                        <td><button data-main="1-1" data-sub="0-0"></button></td>
                        <td><button data-main="1-1" data-sub="0-1"></button></td>
                        <td><button data-main="1-1" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="1-1" data-sub="1-0"></button></td>
                        <td><button data-main="1-1" data-sub="1-1"></button></td>
                        <td><button data-main="1-1" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="1-1" data-sub="2-0"></button></td>
                        <td><button data-main="1-1" data-sub="2-1"></button></td>
                        <td><button data-main="1-1" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
            <td>
                <div id="1-2"></div>
                <table data-sub="1-2" class="table01-2">
                    <tr>
                        <td><button data-main="1-2" data-sub="0-0"></button></td>
                        <td><button data-main="1-2" data-sub="0-1"></button></td>
                        <td><button data-main="1-2" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="1-2" data-sub="1-0"></button></td>
                        <td><button data-main="1-2" data-sub="1-1"></button></td>
                        <td><button data-main="1-2" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="1-2" data-sub="2-0"></button></td>
                        <td><button data-main="1-2" data-sub="2-1"></button></td>
                        <td><button data-main="1-2" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
        </tr>
        <tr>
            <td>
                <div id="2-0"></div>
                <table data-sub="2-0">
                    <tr>
                        <td><button data-main="2-0" data-sub="0-0"></button></td>
                        <td><button data-main="2-0" data-sub="0-1"></button></td>
                        <td><button data-main="2-0" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="2-0" data-sub="1-0"></button></td>
                        <td><button data-main="2-0" data-sub="1-1"></button></td>
                        <td><button data-main="2-0" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="2-0" data-sub="2-0"></button></td>
                        <td><button data-main="2-0" data-sub="2-1"></button></td>
                        <td><button data-main="2-0" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
            <td>
                <div id="2-1" class="table2-1"></div>
                <table data-sub="2-1">
                    <tr>
                        <td><button data-main="2-1" data-sub="0-0"></button></td>
                        <td><button data-main="2-1" data-sub="0-1"></button></td>
                        <td><button data-main="2-1" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="2-1" data-sub="1-0"></button></td>
                        <td><button data-main="2-1" data-sub="1-1"></button></td>
                        <td><button data-main="2-1" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="2-1" data-sub="2-0"></button></td>
                        <td><button data-main="2-1" data-sub="2-1"></button></td>
                        <td><button data-main="2-1" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
            <td>
                <div id="2-2"></div>
                <table data-sub="2-2">
                    <tr>
                        <td><button data-main="2-2" data-sub="0-0"></button></td>
                        <td><button data-main="2-2" data-sub="0-1"></button></td>
                        <td><button data-main="2-2" data-sub="0-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="2-2" data-sub="1-0"></button></td>
                        <td><button data-main="2-2" data-sub="1-1"></button></td>
                        <td><button data-main="2-2" data-sub="1-2"></button></td>
                      </tr>
                      <tr>
                        <td><button data-main="2-2" data-sub="2-0"></button></td>
                        <td><button data-main="2-2" data-sub="2-1"></button></td>
                        <td><button data-main="2-2" data-sub="2-2"></button></td>
                      </tr>
                </table>
            </td>
        </tr>
    </table>
    <button class="restartBtn" id="restartBtn" onclick="start()">RESTART</button>
</body>
</html>
